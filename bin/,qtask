#!/usr/bin/env python3
import base64
import argparse
import datetime
import os

import yagmail

def email_send_qtask(due_date, task, task_notes):
    subject = due_date.strftime("%d/%m/%Y") + ' - ' + task
    email_send_message(subject, task_notes)

def email_send_message(subject, notes):
    email = os.environ['EMAIL_ACCOUNT_ADDR']
    gmail_app_password = os.environ['EMAIL_ACCOUNT_KEY']

    yag = yagmail.SMTP(email, gmail_app_password)

    yag.send(to=email, subject=subject, contents=notes)
    
if __name__ == '__main__':
    parser = argparse.ArgumentParser(description='Create a quick task.')
    parser.add_argument('due_date', type=datetime.date.fromisoformat)
    parser.add_argument('task', type=str)
    parser.add_argument('task_notes', type=str, default=None, nargs='?')
    args = parser.parse_args()

    email_send_qtask(args.due_date, args.task, args.task_notes)
